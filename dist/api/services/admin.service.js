"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true,
});
exports.default = void 0;

var _authentication = _interopRequireDefault(
  require("./authentication.service")
);

var _AdminModel = _interopRequireDefault(require("../../models/AdminModel"));

var _ExaminerModel = _interopRequireDefault(
  require("../../models/ExaminerModel")
);

var _UniversityModel = _interopRequireDefault(
  require("../../models/UniversityModel")
);

var _MetaDeta = _interopRequireDefault(require("../../models/MetaDeta"));

var _express = _interopRequireDefault(require("express"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

class AdminService {
  async signIn(email, password) {
    const user = await _AdminModel.default.findOne({
      email,
    });

    if (!user) {
      return {
        status: 400,
        message: "Admin not found",
      };
    }

    const isPasswordMatch = password === user.password;

    if (!isPasswordMatch) {
      return {
        status: 400,
        message: "Incorrect password",
      };
    }

    console.log(user);

    if (user.email === "coe@ppsu.ac.in" || user.email === "developer@ppsu.db") {
      return {
        status: 200,
        message: "Login successful",
        token: _authentication.default.generateToken(user.id, user.role, true),
      };
    } else {
      return {
        status: 200,
        message: "Login successful",
        token: _authentication.default.generateToken(user.id, user.role, false),
      };
    }
  }

  async updateMetaData() {
    const metaData = await _MetaDeta.default.findOne({
      unique: "metaData",
    });

    if (!metaData) {
      return _MetaDeta.default.create({
        unique: "metaData",
        lastUpdated: new Date(),
      });
    } else {
      // update
      return _MetaDeta.default.findByIdAndUpdate(metaData._id, {
        lastUpdated: new Date(),
      });
    }
  }

  async addExaminer(user) {
    if (user.e_id === "SOE") {
      let count = await _ExaminerModel.default.countDocuments({
        e_id: "SOE",
      });
      count++;

      if (count < 10) {
        user["eid"] = `SOE000${count}`;
      } else if (count < 100) {
        user["eid"] = `SOE00${count}`;
      } else if (count < 1000) {
        user["eid"] = `SOE0${count}`;
      }
    } else if (user.e_id === "SOP") {
      let count = await _ExaminerModel.default.countDocuments({
        e_id: "SOP",
      });
      count++;

      if (count < 10) {
        user["eid"] = `SOP000${count}`;
      } else if (count < 100) {
        user["eid"] = `SOP00${count}`;
      } else if (count < 1000) {
        user["eid"] = `SOP0${count}`;
      }
    } else if (user.e_id === "SON") {
      let count = await _ExaminerModel.default.countDocuments({
        e_id: "SON",
      });
      count++;

      if (count < 10) {
        user["eid"] = `SON000${count}`;
      } else if (count < 100) {
        user["eid"] = `SON00${count}`;
      } else if (count < 1000) {
        user["eid"] = `SON0${count}`;
      }
    } else if (user.e_id === "SLM") {
      let count = await _ExaminerModel.default.countDocuments({
        e_id: "SLM",
      });
      count++;

      if (count < 10) {
        user["eid"] = `SLM000${count}`;
      } else if (count < 100) {
        user["eid"] = `SLM00${count}`;
      } else if (count < 1000) {
        user["eid"] = `SLM0${count}`;
      }
    }

    return _ExaminerModel.default.create(user);
  }

  async deleteExaminer(id) {
    return _ExaminerModel.default.findByIdAndDelete(id);
  }

  async getExaminers(limit) {
    return _ExaminerModel.default.find().limit(limit);
  }

  async getExaminersUsingId(id) {
    return _ExaminerModel.default.findById(id);
  }

  async getExaminersUsingName(name) {
    // index search
    return _ExaminerModel.default.find({
      name,
    });
  }

  async getExaminersUsingEmail(email) {
    return _ExaminerModel.default.find({
      email,
    });
  }

  async getExaminersUsingMobile(mobile) {
    return _ExaminerModel.default.find({
      mobile,
    });
  }

  async getAllExaminers() {
    return _ExaminerModel.default.find();
  } // Super Admin

  async addAdmin(user) {
    const email = user.email;
    const user_Exist = await _AdminModel.default.findOne({
      email,
    });

    if (user_Exist) {
      return {
        status: 400,
        message: "Admin already exists",
      };
    }

    const admin = await _AdminModel.default.create({
      email: user.email,
      password: user.password,
      role: user.role,
      passwordLength: user.password.length,
    });
    return {
      status: 200,
      message: "Admin added successfully",
    };
  }

  async updateAdmin(user) {
    const email = user.email;
    console.log(user);
    const admin = await _AdminModel.default.findOne({
      email,
    });

    if (!admin) {
      return {
        status: 400,
        message: "Admin not found",
      };
    }

    const updatedAdmin = await _AdminModel.default.findByIdAndUpdate(
      admin._id,
      {
        password: user.password,
        passwordLength: user.password.length,
        role: user.role,
      }
    );
    return updatedAdmin;
  }

  async getAdmins() {
    const admins = await _AdminModel.default.find();
    admins.forEach((admin, index) => {
      if (admin.email === "developer@ppsu.db") {
        admins.splice(index, 1);
      }
    });
    return admins;
  }

  async getPassword(email) {
    const admin = await _AdminModel.default.findOne({
      email,
    });

    if (!admin) {
      return {
        status: 400,
        message: "Admin not found",
      };
    }

    return admin.password;
  }

  async updateExaminer(user) {
    console.log(user);
    return _ExaminerModel.default.findByIdAndUpdate(user.id, user);
  }

  async addMultipleUsers(users) {
    const response = [];
    users.forEach(async (user) => {
      const resposne = await this.addExaminer(user);
      response.push(resposne);
    });
    return response;
  }

  async addUniversity(university) {
    return _UniversityModel.default.create(university);
  }

  async getUniversities() {
    return _UniversityModel.default.find();
  }

  async updateUniversity(university) {
    return _UniversityModel.default.findByIdAndUpdate(
      university._id,
      university
    );
  }

  async getDistance(name) {
    return _UniversityModel.default.findOne({
      name,
    });
  }

  async getMetaData() {
    return _MetaDeta.default.findOne({
      unique: "metaData",
    });
  }
}

var _default = new AdminService();

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJBZG1pblNlcnZpY2UiLCJzaWduSW4iLCJlbWFpbCIsInBhc3N3b3JkIiwidXNlciIsIkFkbWluIiwiZmluZE9uZSIsInN0YXR1cyIsIm1lc3NhZ2UiLCJpc1Bhc3N3b3JkTWF0Y2giLCJjb25zb2xlIiwibG9nIiwidG9rZW4iLCJBdXRoZW50aWNhdGlvblNlcnZpY2UiLCJnZW5lcmF0ZVRva2VuIiwiaWQiLCJyb2xlIiwidXBkYXRlTWV0YURhdGEiLCJtZXRhRGF0YSIsIk1ldGFEZXRhIiwidW5pcXVlIiwiY3JlYXRlIiwibGFzdFVwZGF0ZWQiLCJEYXRlIiwiZmluZEJ5SWRBbmRVcGRhdGUiLCJfaWQiLCJhZGRFeGFtaW5lciIsImVfaWQiLCJjb3VudCIsIkV4YW1pbmVyIiwiY291bnREb2N1bWVudHMiLCJkZWxldGVFeGFtaW5lciIsImZpbmRCeUlkQW5kRGVsZXRlIiwiZ2V0RXhhbWluZXJzIiwibGltaXQiLCJmaW5kIiwiZ2V0RXhhbWluZXJzVXNpbmdJZCIsImZpbmRCeUlkIiwiZ2V0RXhhbWluZXJzVXNpbmdOYW1lIiwibmFtZSIsImdldEV4YW1pbmVyc1VzaW5nRW1haWwiLCJnZXRFeGFtaW5lcnNVc2luZ01vYmlsZSIsIm1vYmlsZSIsImdldEFsbEV4YW1pbmVycyIsImFkZEFkbWluIiwidXNlcl9FeGlzdCIsImFkbWluIiwicGFzc3dvcmRMZW5ndGgiLCJsZW5ndGgiLCJ1cGRhdGVBZG1pbiIsInVwZGF0ZWRBZG1pbiIsImdldEFkbWlucyIsImFkbWlucyIsImZvckVhY2giLCJpbmRleCIsInNwbGljZSIsImdldFBhc3N3b3JkIiwidXBkYXRlRXhhbWluZXIiLCJhZGRNdWx0aXBsZVVzZXJzIiwidXNlcnMiLCJyZXNwb25zZSIsInJlc3Bvc25lIiwicHVzaCIsImFkZFVuaXZlcnNpdHkiLCJ1bml2ZXJzaXR5IiwiVW5pdmVyc2l0eU1vZGVsIiwiZ2V0VW5pdmVyc2l0aWVzIiwidXBkYXRlVW5pdmVyc2l0eSIsImdldERpc3RhbmNlIiwiZ2V0TWV0YURhdGEiXSwic291cmNlcyI6WyIuLi8uLi8uLi9zZXJ2ZXIvYXBpL3NlcnZpY2VzL2FkbWluLnNlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEF1dGhlbnRpY2F0aW9uU2VydmljZSBmcm9tIFwiLi9hdXRoZW50aWNhdGlvbi5zZXJ2aWNlXCI7XG5pbXBvcnQgQWRtaW4gZnJvbSBcIi4uLy4uL21vZGVscy9BZG1pbk1vZGVsXCI7XG5pbXBvcnQgRXhhbWluZXIgZnJvbSBcIi4uLy4uL21vZGVscy9FeGFtaW5lck1vZGVsXCI7XG5pbXBvcnQgVW5pdmVyc2l0eU1vZGVsIGZyb20gXCIuLi8uLi9tb2RlbHMvVW5pdmVyc2l0eU1vZGVsXCI7XG5pbXBvcnQgTWV0YURldGEgZnJvbSBcIi4uLy4uL21vZGVscy9NZXRhRGV0YVwiO1xuaW1wb3J0IGUgZnJvbSBcImV4cHJlc3NcIjtcbmNsYXNzIEFkbWluU2VydmljZSB7XG4gIGFzeW5jIHNpZ25JbihlbWFpbCwgcGFzc3dvcmQpIHtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgQWRtaW4uZmluZE9uZSh7IGVtYWlsIH0pO1xuICAgIGlmICghdXNlcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdHVzOiA0MDAsXG4gICAgICAgIG1lc3NhZ2U6IFwiQWRtaW4gbm90IGZvdW5kXCIsXG4gICAgICB9O1xuICAgIH1cbiAgICBjb25zdCBpc1Bhc3N3b3JkTWF0Y2ggPSBwYXNzd29yZCA9PT0gdXNlci5wYXNzd29yZDtcblxuICAgIGlmICghaXNQYXNzd29yZE1hdGNoKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGF0dXM6IDQwMCxcbiAgICAgICAgbWVzc2FnZTogXCJJbmNvcnJlY3QgcGFzc3dvcmRcIixcbiAgICAgIH07XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKHVzZXIpO1xuICAgIGlmICh1c2VyLmVtYWlsID09PSBcImNvZUBwcHN1LmFjLmluXCIgfHwgdXNlci5lbWFpbCA9PT0gXCJkZXZlbG9wZXJAcHBzdS5kYlwiKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGF0dXM6IDIwMCxcbiAgICAgICAgbWVzc2FnZTogXCJMb2dpbiBzdWNjZXNzZnVsXCIsXG4gICAgICAgIHRva2VuOiBBdXRoZW50aWNhdGlvblNlcnZpY2UuZ2VuZXJhdGVUb2tlbih1c2VyLmlkLCB1c2VyLnJvbGUsIHRydWUpLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICAgIG1lc3NhZ2U6IFwiTG9naW4gc3VjY2Vzc2Z1bFwiLFxuICAgICAgICB0b2tlbjogQXV0aGVudGljYXRpb25TZXJ2aWNlLmdlbmVyYXRlVG9rZW4odXNlci5pZCwgdXNlci5yb2xlLCBmYWxzZSksXG4gICAgICB9O1xuICAgIH1cbiAgfVxuICBhc3luYyB1cGRhdGVNZXRhRGF0YSgpIHtcbiAgICBjb25zdCBtZXRhRGF0YSA9IGF3YWl0IE1ldGFEZXRhLmZpbmRPbmUoeyB1bmlxdWU6IFwibWV0YURhdGFcIiB9KTtcbiAgICBpZiAoIW1ldGFEYXRhKSB7XG4gICAgICByZXR1cm4gTWV0YURldGEuY3JlYXRlKHtcbiAgICAgICAgdW5pcXVlOiBcIm1ldGFEYXRhXCIsXG4gICAgICAgIGxhc3RVcGRhdGVkOiBuZXcgRGF0ZSgpLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIHVwZGF0ZVxuICAgICAgcmV0dXJuIE1ldGFEZXRhLmZpbmRCeUlkQW5kVXBkYXRlKG1ldGFEYXRhLl9pZCwge1xuICAgICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICBhc3luYyBhZGRFeGFtaW5lcih1c2VyKSB7XG4gICAgaWYgKHVzZXIuZV9pZCA9PT0gXCJTT0VcIikge1xuICAgICAgbGV0IGNvdW50ID0gYXdhaXQgRXhhbWluZXIuY291bnREb2N1bWVudHMoeyBlX2lkOiBcIlNPRVwiIH0pO1xuICAgICAgY291bnQrKztcbiAgICAgIGlmIChjb3VudCA8IDEwKSB7XG4gICAgICAgIHVzZXJbXCJlaWRcIl0gPSBgU09FMDAwJHtjb3VudH1gO1xuICAgICAgfSBlbHNlIGlmIChjb3VudCA8IDEwMCkge1xuICAgICAgICB1c2VyW1wiZWlkXCJdID0gYFNPRTAwJHtjb3VudH1gO1xuICAgICAgfSBlbHNlIGlmIChjb3VudCA8IDEwMDApIHtcbiAgICAgICAgdXNlcltcImVpZFwiXSA9IGBTT0UwJHtjb3VudH1gO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodXNlci5lX2lkID09PSBcIlNPUFwiKSB7XG4gICAgICBsZXQgY291bnQgPSBhd2FpdCBFeGFtaW5lci5jb3VudERvY3VtZW50cyh7IGVfaWQ6IFwiU09QXCIgfSk7XG4gICAgICBjb3VudCsrO1xuXG4gICAgICBpZiAoY291bnQgPCAxMCkge1xuICAgICAgICB1c2VyW1wiZWlkXCJdID0gYFNPUDAwMCR7Y291bnR9YDtcbiAgICAgIH0gZWxzZSBpZiAoY291bnQgPCAxMDApIHtcbiAgICAgICAgdXNlcltcImVpZFwiXSA9IGBTT1AwMCR7Y291bnR9YDtcbiAgICAgIH0gZWxzZSBpZiAoY291bnQgPCAxMDAwKSB7XG4gICAgICAgIHVzZXJbXCJlaWRcIl0gPSBgU09QMCR7Y291bnR9YDtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHVzZXIuZV9pZCA9PT0gXCJTT05cIikge1xuICAgICAgbGV0IGNvdW50ID0gYXdhaXQgRXhhbWluZXIuY291bnREb2N1bWVudHMoeyBlX2lkOiBcIlNPTlwiIH0pO1xuICAgICAgY291bnQrKztcblxuICAgICAgaWYgKGNvdW50IDwgMTApIHtcbiAgICAgICAgdXNlcltcImVpZFwiXSA9IGBTT04wMDAke2NvdW50fWA7XG4gICAgICB9IGVsc2UgaWYgKGNvdW50IDwgMTAwKSB7XG4gICAgICAgIHVzZXJbXCJlaWRcIl0gPSBgU09OMDAke2NvdW50fWA7XG4gICAgICB9IGVsc2UgaWYgKGNvdW50IDwgMTAwMCkge1xuICAgICAgICB1c2VyW1wiZWlkXCJdID0gYFNPTjAke2NvdW50fWA7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh1c2VyLmVfaWQgPT09IFwiU0xNXCIpIHtcbiAgICAgIGxldCBjb3VudCA9IGF3YWl0IEV4YW1pbmVyLmNvdW50RG9jdW1lbnRzKHsgZV9pZDogXCJTTE1cIiB9KTtcbiAgICAgIGNvdW50Kys7XG5cbiAgICAgIGlmIChjb3VudCA8IDEwKSB7XG4gICAgICAgIHVzZXJbXCJlaWRcIl0gPSBgU0xNMDAwJHtjb3VudH1gO1xuICAgICAgfSBlbHNlIGlmIChjb3VudCA8IDEwMCkge1xuICAgICAgICB1c2VyW1wiZWlkXCJdID0gYFNMTTAwJHtjb3VudH1gO1xuICAgICAgfSBlbHNlIGlmIChjb3VudCA8IDEwMDApIHtcbiAgICAgICAgdXNlcltcImVpZFwiXSA9IGBTTE0wJHtjb3VudH1gO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBFeGFtaW5lci5jcmVhdGUodXNlcik7XG4gIH1cbiAgYXN5bmMgZGVsZXRlRXhhbWluZXIoaWQpIHtcbiAgICByZXR1cm4gRXhhbWluZXIuZmluZEJ5SWRBbmREZWxldGUoaWQpO1xuICB9XG4gIGFzeW5jIGdldEV4YW1pbmVycyhsaW1pdCkge1xuICAgIHJldHVybiBFeGFtaW5lci5maW5kKCkubGltaXQobGltaXQpO1xuICB9XG4gIGFzeW5jIGdldEV4YW1pbmVyc1VzaW5nSWQoaWQpIHtcbiAgICByZXR1cm4gRXhhbWluZXIuZmluZEJ5SWQoaWQpO1xuICB9XG4gIGFzeW5jIGdldEV4YW1pbmVyc1VzaW5nTmFtZShuYW1lKSB7XG4gICAgLy8gaW5kZXggc2VhcmNoXG5cbiAgICByZXR1cm4gRXhhbWluZXIuZmluZCh7IG5hbWUgfSk7XG4gIH1cbiAgYXN5bmMgZ2V0RXhhbWluZXJzVXNpbmdFbWFpbChlbWFpbCkge1xuICAgIHJldHVybiBFeGFtaW5lci5maW5kKHsgZW1haWwgfSk7XG4gIH1cbiAgYXN5bmMgZ2V0RXhhbWluZXJzVXNpbmdNb2JpbGUobW9iaWxlKSB7XG4gICAgcmV0dXJuIEV4YW1pbmVyLmZpbmQoeyBtb2JpbGUgfSk7XG4gIH1cbiAgYXN5bmMgZ2V0QWxsRXhhbWluZXJzKCkge1xuICAgIHJldHVybiBFeGFtaW5lci5maW5kKCk7XG4gIH1cblxuICAvLyBTdXBlciBBZG1pblxuICBhc3luYyBhZGRBZG1pbih1c2VyKSB7XG4gICAgY29uc3QgZW1haWwgPSB1c2VyLmVtYWlsO1xuICAgIGNvbnN0IHVzZXJfRXhpc3QgPSBhd2FpdCBBZG1pbi5maW5kT25lKHsgZW1haWwgfSk7XG4gICAgaWYgKHVzZXJfRXhpc3QpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXR1czogNDAwLFxuICAgICAgICBtZXNzYWdlOiBcIkFkbWluIGFscmVhZHkgZXhpc3RzXCIsXG4gICAgICB9O1xuICAgIH1cbiAgICBjb25zdCBhZG1pbiA9IGF3YWl0IEFkbWluLmNyZWF0ZSh7XG4gICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgIHBhc3N3b3JkOiB1c2VyLnBhc3N3b3JkLFxuICAgICAgcm9sZTogdXNlci5yb2xlLFxuICAgICAgcGFzc3dvcmRMZW5ndGg6IHVzZXIucGFzc3dvcmQubGVuZ3RoLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXR1czogMjAwLFxuICAgICAgbWVzc2FnZTogXCJBZG1pbiBhZGRlZCBzdWNjZXNzZnVsbHlcIixcbiAgICB9O1xuICB9XG4gIGFzeW5jIHVwZGF0ZUFkbWluKHVzZXIpIHtcbiAgICBjb25zdCBlbWFpbCA9IHVzZXIuZW1haWw7XG4gICAgY29uc29sZS5sb2codXNlcik7XG4gICAgY29uc3QgYWRtaW4gPSBhd2FpdCBBZG1pbi5maW5kT25lKHsgZW1haWwgfSk7XG4gICAgaWYgKCFhZG1pbikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdHVzOiA0MDAsXG4gICAgICAgIG1lc3NhZ2U6IFwiQWRtaW4gbm90IGZvdW5kXCIsXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IHVwZGF0ZWRBZG1pbiA9IGF3YWl0IEFkbWluLmZpbmRCeUlkQW5kVXBkYXRlKGFkbWluLl9pZCwge1xuICAgICAgcGFzc3dvcmQ6IHVzZXIucGFzc3dvcmQsXG4gICAgICBwYXNzd29yZExlbmd0aDogdXNlci5wYXNzd29yZC5sZW5ndGgsXG4gICAgICByb2xlOiB1c2VyLnJvbGUsXG4gICAgfSk7XG4gICAgcmV0dXJuIHVwZGF0ZWRBZG1pbjtcbiAgfVxuICBhc3luYyBnZXRBZG1pbnMoKSB7XG4gICAgY29uc3QgYWRtaW5zID0gYXdhaXQgQWRtaW4uZmluZCgpO1xuXG4gICAgYWRtaW5zLmZvckVhY2goKGFkbWluLCBpbmRleCkgPT4ge1xuICAgICAgaWYgKGFkbWluLmVtYWlsID09PSBcImRldmVsb3BlckBwcHN1LmRiXCIpIHtcbiAgICAgICAgYWRtaW5zLnNwbGljZShpbmRleCwgMSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGFkbWlucztcbiAgfVxuICBhc3luYyBnZXRQYXNzd29yZChlbWFpbCkge1xuICAgIGNvbnN0IGFkbWluID0gYXdhaXQgQWRtaW4uZmluZE9uZSh7IGVtYWlsIH0pO1xuICAgIGlmICghYWRtaW4pIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXR1czogNDAwLFxuICAgICAgICBtZXNzYWdlOiBcIkFkbWluIG5vdCBmb3VuZFwiLFxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIGFkbWluLnBhc3N3b3JkO1xuICB9XG5cbiAgYXN5bmMgdXBkYXRlRXhhbWluZXIodXNlcikge1xuICAgIGNvbnNvbGUubG9nKHVzZXIpO1xuICAgIHJldHVybiBFeGFtaW5lci5maW5kQnlJZEFuZFVwZGF0ZSh1c2VyLmlkLCB1c2VyKTtcbiAgfVxuICBhc3luYyBhZGRNdWx0aXBsZVVzZXJzKHVzZXJzKSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBbXTtcbiAgICB1c2Vycy5mb3JFYWNoKGFzeW5jICh1c2VyKSA9PiB7XG4gICAgICBjb25zdCByZXNwb3NuZSA9IGF3YWl0IHRoaXMuYWRkRXhhbWluZXIodXNlcik7XG4gICAgICByZXNwb25zZS5wdXNoKHJlc3Bvc25lKTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH1cbiAgYXN5bmMgYWRkVW5pdmVyc2l0eSh1bml2ZXJzaXR5KSB7XG4gICAgcmV0dXJuIFVuaXZlcnNpdHlNb2RlbC5jcmVhdGUodW5pdmVyc2l0eSk7XG4gIH1cbiAgYXN5bmMgZ2V0VW5pdmVyc2l0aWVzKCkge1xuICAgIHJldHVybiBVbml2ZXJzaXR5TW9kZWwuZmluZCgpO1xuICB9XG4gIGFzeW5jIHVwZGF0ZVVuaXZlcnNpdHkodW5pdmVyc2l0eSkge1xuICAgIHJldHVybiBVbml2ZXJzaXR5TW9kZWwuZmluZEJ5SWRBbmRVcGRhdGUodW5pdmVyc2l0eS5faWQsIHVuaXZlcnNpdHkpO1xuICB9XG4gIGFzeW5jIGdldERpc3RhbmNlKG5hbWUpIHtcbiAgICByZXR1cm4gVW5pdmVyc2l0eU1vZGVsLmZpbmRPbmUoeyBuYW1lIH0pO1xuICB9XG4gIGFzeW5jIGdldE1ldGFEYXRhKCkge1xuICAgIHJldHVybiBNZXRhRGV0YS5maW5kT25lKHsgdW5pcXVlOiBcIm1ldGFEYXRhXCIgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgbmV3IEFkbWluU2VydmljZSgpO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFDQSxNQUFNQSxZQUFOLENBQW1CO0VBQ0wsTUFBTkMsTUFBTSxDQUFDQyxLQUFELEVBQVFDLFFBQVIsRUFBa0I7SUFDNUIsTUFBTUMsSUFBSSxHQUFHLE1BQU1DLG1CQUFBLENBQU1DLE9BQU4sQ0FBYztNQUFFSjtJQUFGLENBQWQsQ0FBbkI7O0lBQ0EsSUFBSSxDQUFDRSxJQUFMLEVBQVc7TUFDVCxPQUFPO1FBQ0xHLE1BQU0sRUFBRSxHQURIO1FBRUxDLE9BQU8sRUFBRTtNQUZKLENBQVA7SUFJRDs7SUFDRCxNQUFNQyxlQUFlLEdBQUdOLFFBQVEsS0FBS0MsSUFB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
